const fecha=new Date,hora=fecha.toLocaleTimeString(),horaMin=hora.substr(0,5),horas=(fecha.getHours()<10?"0":"")+fecha.getHours(),minutos=(fecha.getMinutes()<10?"0":"")+fecha.getMinutes(),segundos=(fecha.getSeconds()<10?"0":"")+fecha.getSeconds(),festivosCol=[[1,9],[],[25,28,29],[],[1,13],[3,10],[1,20],[7,19],[],[14],[4,11],[8,25]],urlPage=window.location.href,urlPageLimpia=urlPage.split("?")[0],urlSite=urlPage.split("/")[2],formatoHora=`${horas}:${minutos}:${segundos}`,fechaComoCadena=fecha,dias=["domingo","lunes","martes","miércoles","jueves","viernes","sábado"],content=document.getElementById("cont-principal");var urlKT="https://feeds.datafeedwatch.com/95958/fb2f5eb90322be8f5cb1aea469a4551436034440.json",urlAK="https://feeds.datafeedwatch.com/95958/3a4f7dba63e51e01ff8ad165f123a825cf30f99b.json",urlALKP="https://feeds.datafeedwatch.com/95958/c75c33c5369da362ae3e6fafb56ecd0b0ef78319.json",textoIngresado="";let opSelect,urlAPI;switch(urlSite){case"www.alkosto.com":urlAPI=urlAK,site="Tiendas Alkosto";break;case"www.ktronix.com":urlAPI=urlKT,site="Tiendas Ktronix";break;case"www.alkomprar.com":urlAPI=urlALKP,site="Tiendas Alkomprar"}let globalData={};const numeroDia=new Date(fechaComoCadena).getDay(),mesActual=festivosCol[fecha.getMonth()],diaActual=fecha.getDate();let filtroFestivo=mesActual.filter((a=>a==diaActual));const esFestivo=filtroFestivo.length>0&&filtroFestivo[0]===diaActual,diasSemana=["dom","lun","mar","mie","jue","vie","sab"];let horarios={};const nombreDia=dias[numeroDia];function limpiarTexto(a){return a.replace().replace(/[áàäâå]/,"a").replace(/[éèëê]/,"e").replace(/[íìïî]/,"i").replace(/[óòöô]/,"o").replace(/[úúüû]/,"u").replace(/[ñ]/,"n").replace(/[\s()/*´'{}]+/gi,"-").replace(/[\u0300-\u036f]/g,"").toLowerCase()}function infoStore(){fetch(`${urlAPI}`).then((a=>a.json())).then((a=>{globalData["info-all"]=a.products;let e=globalData["info-all"].filter((a=>null!=a.tienda&&a.url_tienda==urlPageLimpia));printInfo(e[0]);let r=globalData["info-all"].filter((a=>null!=a.tienda&&a.ciudad_tienda==e[0].ciudad_tienda&&a.nombre_tienda!=e[0].nombre_tienda));r.length>=1&&otherStores(r)}))}const printInfo=a=>{let e="";e=esFestivo?" festivo":"",diasSemana.forEach(((e,r)=>{const s=r;let o=a[`ap_${e}`],t=a[`cie_${e}`];numeroDia===s&&esFestivo&&"Cerrado"!==o&&(o=a.ap_dom,t=a.cie_dom),horarios[`ap_${e}`]=o,horarios[`cie_${e}`]=t}));const r=diasSemana.map(((a,e)=>{const r=dias[e];return{apertura:horarios[`ap_${a}`],cierre:horarios[`cie_${a}`],dia:r}})),s=[...r.slice(numeroDia),...r.slice(0,numeroDia)];let o="";o="Cerrado"==s[0].apertura||"Cerrado"==s[0].cierre?`<p class="apertura">Hoy ${s[0].dia}${e}: <br><span class="close-txt"> Cerrado, abre mañana a las ${s[1].apertura.substr(0,5)} a. m. </span></p>`:s[0].apertura<=formatoHora&&s[0].cierre>=formatoHora?`<p class="apertura">Hoy ${s[0].dia}${e}: <br> <span class="open"> abierto, cierra a las ${s[0].cierre.substr(0,2)-12}${s[0].cierre.substr(2,3)} p. m. </span></p>`:s[0].apertura>=formatoHora&&s[0].cierre>=formatoHora?`<p class="apertura"><span class="close-txt">Cerrado, abre a las ${s[0].apertura.substr(0,5)} a. m. </span></p>`:`<p class="apertura">Hoy ${s[0].dia}${e}: <br> <span class="close-txt"> Cerrado, abre mañana a las ${s[1].apertura.substr(0,5)} a. m.</span></p>`;let t,i="";s.map(((a,e)=>{let r="";return r=r="Cerrado"==a.apertura||"Cerrado"==a.cierre?`<li class='element-hor'>${a.dia.charAt(0).toUpperCase()+a.dia.slice(1)}: Cerrado</li>`:`<li class="element-hor">${a.dia.charAt(0).toUpperCase()+a.dia.slice(1)} de: ${a.apertura.substr(0,5)} a. m. a ${a.cierre.substr(0,2)-12}${a.cierre.substr(2,3)} p. m.</li>`,i+=r}));let n=new Date(`${a.vig_msj} 23:59:00 GMT-0500`);t=fecha<=n?`<div class="cont-alert">\n    <div class="alert alert-info">\n    <p>${a.msj_alert}. Te invitamos a seguir comprando en <a class="alert-link" href="/">Alkomprar.com</a></p>\n    </div>\n    </div>`:"";const l=`\n<div class="cont-all">\n    <div class="row cont-info-store">\n    <div class="col-md-5 mb-4">\n    <img src="${a.img_tienda}" class="img img-responsive img-store" width="800" alt="${a.nombre_tienda}">\n    </div>\n    <div class="col-md-4 mb-4 info-gen">\n    <div class="info_detalle">\n    <h1 class="name-store">${a.nombre_tienda}</h1>\n    <h2 class="txt-ciudad">${a.ciudad_tienda}</h2>\n    <p class="direc">${a.dir_tienda}</p>\n    </div>\n    ${o}\n    <div class="links_detalle">\n    <span><a target="_blank" rel="noopener" title="Como llegar" href="${a.url_llegar}"><i class="alk-icon-arrive"></i> Como llegar</a></span>\n    <span><a target="_blank" rel="noopener" title="Ver mapa" href="${a.url_maps}"><i class="alk-icon-ver-mapa"></i> Ver mapa y horarios</a></span>\n     </div>\n   </div>\n    <div class="col-md-3 mb-4 cont-horarios">\n    <span class="tit_horario mb-2"><i class="alk-icon-clock"></i> Horarios</span>\n   <ul class="lists-hor">\n   ${i}\n   </ul> \n    </div>\n    </div>\n</div>\n    <div class="row">\n    <div class="col-md-12">\n    ${t}\n    </div>\n    </div>\n    `;content.innerHTML=l},otherStores=a=>{const e=document.querySelector("#title-other-stores"),r=document.querySelector("#other-stores");let s=`<div class="col-md-12"><h3 class="title-sect-2"><span class="span-title">Otras tiendas en ${a[0].ciudad_tienda.split(",")[0]} </span></h3></div>`;const o=a.map(((a,e)=>{diasSemana.forEach(((e,r)=>{const s=r;let o=a[`ap_${e}`],t=a[`cie_${e}`];numeroDia===s&&esFestivo&&"Cerrado"!==o&&(o=a.ap_dom,t=a.cie_dom),horarios[`ap_${e}`]=o,horarios[`cie_${e}`]=t}));const r=diasSemana.map(((a,e)=>{const r=dias[e];return{apertura:horarios[`ap_${a}`],cierre:horarios[`cie_${a}`],dia:r}})),s=[...r.slice(numeroDia),...r.slice(0,numeroDia)];let o,t="";return"Cerrado"==s[0].apertura||"Cerrado"==s[0].cierre?(o='<span class="badge bg-danger">Cerrado</span>',t=`<p class="horario abierto"><i class="alk-icon-clock"></i> Cerrado, abre mañana a las ${s[1].apertura.substr(0,5)} a. m.</p>`):s[0].apertura<=formatoHora&&s[0].cierre>=formatoHora?(o='<span class="badge bg-primary">Abierto</span>',t=`<p class="horario abierto"><i class="alk-icon-clock"></i> Hoy de ${s[0].apertura.substr(0,5)} a. m. a ${s[0].cierre.substr(0,2)-12}${s[0].cierre.substr(2,3)} p. m. </p>`):s[0].apertura>=formatoHora&&s[0].cierre>=formatoHora?(o='<span class="badge bg-danger">Cerrado</span>',t=`<p class="horario abierto"><i class="alk-icon-clock"></i> Hoy de ${s[0].apertura.substr(0,5)} a. m. a ${s[0].cierre.substr(0,2)-12}${s[0].cierre.substr(2,3)} p. m. </p>`):(o='<span class="badge bg-danger">Cerrado</span>',t=`<p class="horario abierto"><i class="alk-icon-clock"></i> Cerrado, abre mañana a las ${s[1].apertura.substr(0,5)} a. m.</p>`),`\n        <div class="col-xs-12 col-sm-6 col-md-4">\n            <div class="card">\n                <div class="card-header">\n                    <h2 class="card-subtitle">\n                    ${a.nombre_tienda}\n                    </h2>\n                    ${o}\n                </div>\n                        <div class="card-body">\n                            <div class="cont-info-card">\n                            <p class="horario-tienda">${a.dir_tienda}</p>\n                            ${t}\n                            </div>\n                            <div class="row d-flex">\n                            <a class="btn-detail" href="${a.url_tienda}" title="ir a tienda ${a.nombre_tienda}">\n                            <div class="btn-card">\n                            Ver detalle\n                            </div>\n                            </a>\n                            <a class="btn-detail" href="${a.url_llegar}" title="Como llegar a ${a.nombre_tienda}">\n                            <div class="btn-card bl-d">\n                            Cómo llegar\n                            </div>\n                            </a>\n                            </div>\n                         </div>  \n            </div>\n        </div>\n        `})).join("");e.innerHTML=s,r.innerHTML=o};infoStore();